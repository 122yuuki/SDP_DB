# 2．SQLの基本部文法2

前ページのSQLだけでは高度なデータ操作をすることができないため、より具体的なSQLについて紹介する。  
様々な文法があるが、Section4で使用するものを主に紹介する。  
以降で使用するテーブルは、この2つに限定する。  

<img width="500" src="https://github.com/122yuuki/SDP_DB/blob/main/Section_2/DB_%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E4%BE%8B.png">
<img width="250" src="https://github.com/122yuuki/SDP_DB/blob/main/Section_2/DB_%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E4%BE%8B2.png">  

## 2-1.where句, order by句

1．「***where句***」は、特定のカラム(列)もしくはタプル(組)を操作させるときに使用する。  

使い方：` where 条件式; `

例 1：
```
select 学籍番号 from 学生情報
  where クラス = 'A';
```
実行結果：
| 学籍番号 |
|:---:|
|b1990000|
|b1990050|

例 2：
```
select 学籍番号 from 学生情報
  where 出席番号 > 10 and 出席番号 < 40;
```
実行結果：
| 学籍番号 |
|:---:|
|b1990020|
|b1990030|
|b1990040|
<br>

2．「***order by句***」とは、出力結果のタプルの順番を降順もしくは昇順に並べ替えるときに使用する。  

- `asc`：昇順
- `desc`：降順  

使い方：` order by 列名 ascまたはdesc; `   

例：
```
select 学籍番号 from 学生情報
  where 出席番号 > 10 and 出席番号 < 40
  order by 出席番号 asc;
```
実行結果：
| 学籍番号 |
|:---:|
|b1990030|
|b1990040|
|b1990020|

## 2-2.limit句, distinct句

1．「***limit句***」とは、先頭から指定した行数分のタプルを取得するときに使用する。  

使い方：` limit 行数; `  

例：
```
select 学籍番号 from 学生情報
  where 出席番号 > 10 and 出席番号 < 40
  order by 出席番号 asc
  limit 2;
```
実行結果：
| 学籍番号 |
|:---:|
|b1990030|
|b1990040|
<br>

2．「***distinct句***」とは、重複したタプルを削除するときに使用する。  

使い方：` select distinct 学籍番号 from 学生情報; `  

例：
```
insert into 学生情報
  values ('b1990000', '千歳', '太郎', 'A', 1)
         ('b1990020', '山田', '新之助', 'B', 34)
         ('b1990060', '恵庭', '丸子', 'D', 5);
```
```
select distinct 学籍番号 from 学生情報;
```
実行結果：
| 学籍番号 |
|:---:|
|b1990000|
|b1990010|
|b1990020|
|b1990030|
|b1990040|
|b1990050|
|b1990060|

## 2-3.join句

「***join句***」とは、テーブルの結合をするときに使用する。様々な使い方があり理解しづらいと思うため、その場合は実際にPostgreSQLで動かしてみるとよい。  

使い方：
- ` inner join テーブル名 on 条件式; ` (内部結合)
- ` outer join テーブル名 on 条件式; ` (外部結合)

`outer join`の文頭に`left(right)`を付け加えると、結合操作が左列(右列)を基準にして行われる。  

例 1：
```
select 学生情報.学籍番号, 数学考査.得点 from 学生情報
  inner join 数学考査
  on 学生情報.学籍番号 = 数学考査.学籍番号;
```
実行結果：
| 学籍番号 | 得点 |
|:---:|:---:|
|b1990000|80|
|b1990020|100|
|b1990040|67|
|b1990050|55|


例 2：
```
select 学生情報.学籍番号, 数学考査.得点 from 学生情報
left outer join 数学考査
on 学生情報.学籍番号 = 数学考査.学籍番号;
```
実行結果：
| 学籍番号 | 得点 |
|:---:|:---:|
|b1990000|80|
|b1990010|null|
|b1990020|100|
|b1990030|null|
|b1990040|67|
|b1990050|55|

例を見ると、`inner join`と`outer join`の実行結果が若干異なっているのがわかるだろう。`inner join`は内部結合で、結合元のテーブルのみを結合先と結合する。`outer join`は外部結合で、結合先のテーブルに結合元のテーブルのデータがなくても、結合先のテーブルに合わせて結合している。そのため、実行結果に違いが見られた。  

なぜ得点が`null`のものが出現したのかというと、数学考査テーブルを見た時に学籍番号が「b1990010」と「b1990030」は存在していなく、得点列にデータがないため`null`と出力された。  

ちなみに、今まで`on 条件式`を付け加えて説明しているものがあるが、付け加えなくても動作はする。`on 条件式`がないと、それよりも前のクエリがすべてのデータに対して行われるため、使い方には注意が必要である。  

## 2-4.SQLにおける関数

count関数やmax関数といった数学的関数をSQLで使用することできる。  

単一行関数：検索結果の１組ごとに計算や加工を行う関数。  
| 関数名 | 意味 | 使用例 |
| :---: | :---: | :---: |
| length | 文字列の文字数を求める |`select length(列名) from テーブル名;`|
| lower | 小文字に変換 |`select lower(列名) from テーブル名;`|
| upper | 大文字に変換 |`select upper(列名) from テーブル名;`|
| abs | 絶対値を求める |`select abs(列名) from テーブル名;`|
| sqrt | 平方根を求める |`select sqrt(列名) from テーブル名;`|

集約関数：検索結果の全組を集約して計算や加工を行う関数。　　
| 関数名 | 意味 | 使用例 |
| :---: | :---: | :---: |
| sum | 合計値を計算する |`select sum(列名) from テーブル名;`|
| avg | 平均値を求める |`select avg(列名) from テーブル名;`|
| max | 最大値を求める |`select max(列名) from テーブル名;`|
| min | 最小値を求める |`select min(列名) from テーブル名;`|
| count | 検索結果の全組の組数を求める |`select count(列名) from テーブル名;`|
___
[目次へ](https://github.com/122yuuki/SDP_DB/blob/main/README.md)  

[前のページ](https://github.com/122yuuki/SDP_DB/blob/main/Section_2/section_2-2.md)  

[次のページ](https://github.com/122yuuki/SDP_DB/blob/main/Section_2/section_2-4.md)
